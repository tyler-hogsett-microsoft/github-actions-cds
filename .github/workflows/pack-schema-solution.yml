name: CI

on: [push]

jobs:
  build:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    - name: Install CDS Core Tools
      run: |
        ## Download nuget.exe
        $sourceNugetExe = "https://dist.nuget.org/win-x86-commandline/latest/nuget.exe"
        $targetNugetExe = "$env:GITHUB_WORKSPACE\nuget.exe"
        Invoke-WebRequest $sourceNugetExe -OutFile $targetNugetExe
        Set-Alias nuget $targetNugetExe -Scope Global -Verbose

        $toolsFolder = $env:GITHUB_WORKSPACE\tools
        ## Download CoreTools
        nuget install Microsoft.CrmSdk.CoreTools -O $toolsFolder
        md $toolsFolder\CoreTools
        $coreToolsFolder = Get-ChildItem $toolsFolder | Where-Object {$_.Name -match 'Microsoft.CrmSdk.CoreTools.'}
        move $toolsFolder\$coreToolsFolder\content\bin\coretools\*.* $toolsFolder\CoreTools
        Remove-Item $toolsFolder\$coreToolsFolder -Force -Recurse